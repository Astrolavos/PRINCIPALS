set -e
shopt -s expand_aliases
alias antrea="kubectl -n kube-system exec -it antrea-agent-h5slq  -c antrea-agent --"

if [ -z "$1" ]
then
 echo "Source container needs to be passed in"
 exit
fi

if [ -z "$2" ]
then
 echo "Destination container needs to be passed in"
 exit
fi

VMNAME=$1
MONITOR_NAME=$2


VM_PORT=$(antrea antctl get podinterface | grep $VMNAME | tr -s ' ' | cut -d' ' -f 3)
MONITOR_PORT=$(antrea antctl get podinterface | grep $MONITOR_NAME | tr -s ' ' | cut -d' ' -f 3)
echo " * VM Port: "$VM_PORT
echo " * Monitor Port: " $MONITOR_PORT
antrea ovs-ofctl mod-flows br-int "table=10,ip,in_port=$VM_PORT,actions=resubmit(,29),output:$MONITOR_PORT"
echo " ! Redirection Success"


